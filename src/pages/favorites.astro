---
// Favorites page - display favorite books
import { getCollection } from 'astro:content';
import BaseHead from '@components/BaseHead.astro';
import Footer from '@components/Footer.astro';
import MainNav from '@components/MainNav.astro'; // logo, nav
import BookShelf from '@components/BookShelf.astro';

let pageTitle = "Kyle Johnston's Bookshelf Â· Favorites"
let description = 'My favorite books from the collection.';
let permalink = 'https://books.kyleio.com/favorites/';

function formatDate(dateString) {
  if (!dateString) return '';
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    timeZone: 'UTC'
  });
}

// Get all favorite books, sorted by most recently added
const favoriteBooks = (await getCollection('book'))
  .filter(book => book.data.favorite === true)
  .sort((a, b) => {
    const dateA = new Date(a.data.added);
    const dateB = new Date(b.data.added);
    return dateB.valueOf() - dateA.valueOf();
  });
---

<html lang="en">

<head>
    <BaseHead {pageTitle} {description} {permalink} />
</head>

<body>
    <MainNav />
    <main class="content">
		<div class="grid grid-cols-4 justify-center items-start px-4 pt-4 text-lg text-gray-700 md:px-8 md:pt-8 md:justify-between;">
			<div class="col-span-3">
									<h1 class="mb-2">Favorites</h1>
			</div>
			<div class="col-span-1 m-0! pl-4 py-3 flex gap-4 content-start justify-end items-start">
                <a href="/" aria-label="View favorites page">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                      <title id="favoritesIconTitle">Favorites icon</title>
                      <desc>View favorites</desc>
                      <path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z" />
                    </svg>
                </a>
                <a href="/list" aria-label="Switch to list view">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="size-6" role="img" aria-labelledby="listIconTitle">
                        <title id="listIconTitle">List icon</title>
                        <desc>Switch to list view</desc>
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                    </svg>
                </a>
            </div>
        </div>

        {favoriteBooks.length > 0 ? (
        <section aria-label="Favorite Books" id="view-container"
            class="px-4 py-4 gap-4 grid grid-cols-2 items-end md:grid-cols-4 md:px-8 md:py-8 md:gap-8;">
            {favoriteBooks.map((book) => <BookShelf post={book} formatDate={formatDate(book.data.added)} />)}
        </section>
        ) : (
        <section class="px-4 py-8 text-center md:px-8 md:py-16">
            <p class="text-gray-600 text-lg">No favorite books selected yet.</p>
            <p class="text-gray-500 mt-2">Books marked as favorites will appear here.</p>
        </section>
        )}

    </main>
    <Footer />
</body>

</html>