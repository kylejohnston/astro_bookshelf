---
// Homepage - display a paginated list of books
import { getCollection } from 'astro:content';
import BaseHead from '@components/BaseHead.astro';
import Footer from '@components/Footer.astro';
import MainNav from '@components/MainNav.astro'; // logo, nav
import BookShelf from '@components/BookShelf.astro';
import Search from "astro-pagefind/components/Search";

let pageTitle = "Kyle Johnston's Bookshelf Â· Home"
let description = 'A running list of the books I\'ve read.';
let permalink = 'https://books.kyleio.com/';

function formatDate(dateString) {
  if (!dateString) return '';
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    timeZone: 'UTC'
  });
}

// 1. Generate a new path for every collection entry
export async function getStaticPaths({ paginate }) {
    const books = (await getCollection('book')).sort((a, b) => {
        const dateA = new Date(a.data.added);
        const dateB = new Date(b.data.added);
        return dateB.valueOf() - dateA.valueOf();
    });
    return paginate(books, { pageSize: 24 });
}

// 2. When it's time to render, you can get the entry directly from the prop
const { page } = Astro.props;
// const { Content } = await book.render();
---

<html lang="en">

<head>
    <BaseHead {pageTitle} {description} {permalink} />
</head>

<body>
    <MainNav />
    <main class="content">
		<div class="grid grid-cols-4 justify-center items-start px-4 pt-4 text-lg text-gray-700 md:px-8 md:pt-8 md:justify-between;">
			<Search id="search" className="pagefind-ui col-span-3" uiOptions={{ showImages: false }} />
			<div class="col-span-1 m-0! pl-4 py-3 flex gap-4 content-start justify-end items-start">
				<a href="/favorites" aria-label="Toggle favorites view">
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
						<title id="favoritesIconTitle">Toggle favorites view</title>
						<desc>Toggle favorites view</desc>
						<path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
					</svg>
				</a>
                <a href="/list" aria-label="Switch to list view">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
						<title id="gridIconTitle">Switch to list view</title>
						<desc>Switch to list view</desc>
						<path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
					</svg>
                </a>
            </div>
        </div>

        <section aria-label="Bookshelf" id="view-container"
            class="px-4 py-4 gap-4 grid grid-cols-2 items-end md:grid-cols-4 md:px-8 md:py-8 md:gap-8;">
            {page.data.map((book) => <BookShelf post={book} formatDate={formatDate(book.data.added)} />)}
        </section>

        <div
            class="flex justify-center items-center font-headline uppercase px-4 pb-4 text-lg text-gray-700 md:px-8 md:pb-8 md:justify-between md:text-2xl;">
            <div class="flex gap-4 items-center">
                {page.url.prev ?
                <a href={page.url.prev} aria-label="Previous page">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        stroke-width="1.5" class="w-7 h-7 md:w-10 md:h-10">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                    </svg>
                </a>
                :
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-7 h-7 md:w-10 md:h-10">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                </svg>
                }
                Page {page.currentPage} of {page.lastPage}
                {page.url.next ?
                <a href={page.url.next} class="stroke-gray-200" aria-label="Next page">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        stroke-width="1.5" class="w-7 h-7 md:w-10 md:h-10">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                    </svg>
                </a>
                :
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-7 h-7 md:w-10 md:h-10">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                </svg>
                }
            </div>
        </div>
    </main>
    <Footer />
</body>

</html>

<style>
    :root {
        --pagefind-ui-scale: 0.75;
        --pagefind-ui-border: #12121244;
        --pagefind-ui-border-radius: 12px;
        --pagefind-ui-font: var(--font-mono);
    }
</style>
